<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" />
    <meta content="width=1300, initial-scale=1 user-scalable=yes" name="viewport" />
    <meta content="行者无疆，始于足下——行走，思考，在路上" name="description" />
    <meta content="web development, programming, typeface, typography" name="keywords" />
    <meta content="Xiao Hanyu" name="author" />
    <link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180" />
    <link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png" />
    <link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png" />
    <link href="/manifest.json" rel="manifest" />
    <link color="#5bbad5" href="/safari-pinned-tab.svg" rel="mask-icon" />
    <meta content="#ffffff" name="theme-color" />
    <title>DVD 视频提取转换初步研究</title>
    <link href="/static/dist/semantic-ui/semantic.min.css" rel="stylesheet" type="text/css" />
    <link href="/static/dist/fonts.css/fonts.css" rel="stylesheet" type="text/css" />
    <link href="/static/stylesheet/default.css" rel="stylesheet" type="text/css" />
    <link href="/static/stylesheet/pandoc-code-highlight.css" rel="stylesheet" type="text/css" />
    <script src="/static/dist/jquery/jquery.min.js"></script>
  </head>
  <body lang="cn">
    <div data-quotes-cn="[{&quot;content&quot;:[&quot;天上星，亮晶晶，永灿烂，长安宁。&quot;,&quot;湖边竹，盈盈绿，报平安，多喜乐。&quot;],&quot;author&quot;:&quot;金庸&quot;,&quot;from&quot;:&quot;天龙八部&quot;},{&quot;content&quot;:[&quot;死亡是唯一一座永远亮着的灯塔，不管你向哪里航行，最终都得转向它指引的方向。一切都会逝去，只有死神永生。&quot;],&quot;author&quot;:&quot;刘慈欣&quot;,&quot;from&quot;:&quot;地球往事&quot;},{&quot;content&quot;:[&quot;我终于明白了为什么 Einstein 喜爱看守灯塔的职业，因为那样他可以在自己的心灵中建立一片宁静而自由的天空。&quot;],&quot;author&quot;:&quot;卢昌海&quot;,&quot;from&quot;:&quot;&lt;a href=\&quot;http://www.changhai.org\&quot;&gt;http://www.changhai.org&lt;/a&gt;&quot;},{&quot;content&quot;:[&quot;我宁愿游荡在你身边&quot;,&quot;做七天的野鬼&quot;,&quot;跟随你&quot;,&quot;就算落进最黑暗的地方&quot;,&quot;我的爱&quot;,&quot;也不会让我成为永远的孤魂&quot;],&quot;author&quot;:&quot;李安&quot;,&quot;from&quot;:&quot;卧虎藏龙&quot;},{&quot;content&quot;:[&quot;在中国，任何超脱飞扬的思想都会砰然坠地——现实的引力实在是太沉重了。&quot;],&quot;author&quot;:&quot;刘慈欣&quot;,&quot;from&quot;:&quot;地球往事&quot;},{&quot;content&quot;:[&quot;天下唯庸人无咎无誉。&quot;],&quot;author&quot;:&quot;梁启超&quot;,&quot;from&quot;:&quot;李鸿章传&quot;},{&quot;content&quot;:[&quot;沧海横流，血肉横飞，方显出英雄本色，当年万源保卫战，敌军在不到 30 华里的地面上，使用兵力竞达九十个团，数量十倍于红军，谁能记清当时打了多少次恶仗？每天要牺牲多少人？他却是不多的幸存者之一。而眼前，一切都沉寂了，流逝了。那惊心动魄的枪声，那撕肝裂肺的呐喊，那悲痛欲绝的咒骂和呻吟，那狼藉遍野的残肢断骨和头颅，那千疮百孔仍迎风飘扬的军旗；都沉寂了，流逝了，无影无踪了，犹如做了一场梦……&quot;],&quot;author&quot;:&quot;都梁&quot;,&quot;from&quot;:&quot;亮剑&quot;}]" data-quotes-en="[{&quot;content&quot;:[&quot;Pascal is for building pyramids—imposing, breathtaking, static structures built by armies pushing heavy blocks into place. Lisp is for building organisms—imposing, breathtaking, dynamic structures built by squads fitting fluctuating myriads of simpler organisms into place.&quot;],&quot;author&quot;:&quot;Alan J. Perlis&quot;,&quot;from&quot;:&quot;foreword for &lt;a href=\&quot;http://mitpress.mit.edu/sicp/\&quot;&gt;SICP&lt;/a&gt;&quot;},{&quot;content&quot;:[&quot;When you don&#39;t create things, you become defined by your tastes rather than ability. Your tastes only narrow &amp; exclude people. So create.&quot;],&quot;author&quot;:&quot;why the luck stiff&quot;,&quot;from&quot;:&quot;&lt;a href=\&quot;http://whymirror.github.io/\&quot;&gt;http://whymirror.github.io/&lt;/a&gt;&quot;},{&quot;content&quot;:[&quot;In theory, there is no difference between theory and practice. But, in practice, there is.&quot;],&quot;author&quot;:&quot;Jan L. A. van de Snepscheut&quot;,&quot;from&quot;:&quot;&lt;a href=\&quot;http://en.wikiquote.org/wiki/Jan_L._A._van_de_Snepscheut\&quot;&gt;Wikipedia&lt;/a&gt;&quot;},{&quot;content&quot;:[&quot;The future has already arrived. It is just not evenly distributed yet.&quot;],&quot;author&quot;:&quot;William Gibson&quot;,&quot;from&quot;:&quot;&lt;a href=\&quot;https://en.wikiquote.org/wiki/William_Gibson\&quot;&gt;Wikiquote&lt;/a&gt;&quot;},{&quot;content&quot;:[&quot;There are many ways of trying to understand programs. People often rely too much on one way, which is called \&quot;debugging\&quot; and consists of running a partly-understood program to see if it does what you expected. Another way, which ML advocates, is to install some means of understanding in the very programs themselves.&quot;],&quot;author&quot;:&quot;Robin Milner&quot;,&quot;from&quot;:&quot;foreword for &lt;a href=\&quot;http://www.ccs.neu.edu/home/matthias/BTML/\&quot;&gt;The Little MLer&lt;/a&gt;&quot;}]" id="quotes" style="display: none"></div>
    <div id="content">
      <nav class="ui borderless menu" lang="en">
        <div class="ui container">
          <a class="item" href="/"><img src="/static/image/gravatar-black.svg" /></a><a class="item" href="/archive">Archive</a><a class="item desktop-only" href="/categories">Categories</a><a class="item desktop-only" href="/tags">Tags</a><a class="item" href="/about">About</a>
          <div class="right menu">
            <div class="item desktop-only">
              <form action="https://www.google.com/search" class="ui form" method="get" target="_blank">
                <input name="q" type="hidden" value="site:xiaohanyu.me" />
                <div class="ui transparent left icon input">
                  <input name="q" placeholder="Search..." type="text" /><i class="search icon"></i>
                </div>
              </form>
            </div>
            <a class="item" href="https://github.com/xiaohanyu"><i class="github icon"></i></a><a class="item desktop-only" href="/atom.xml"><i class="feed icon"></i></a>
          </div>
        </div>
      </nav><div class="ui stackable container">
  <div class="ui very padded segment article">
    <article class="ui stackable divided grid"><header class="row article-head">
  <div class="column">
    <h1 class="ui header">
      DVD 视频提取转换初步研究
    </h1>
    <div class="ui divider"></div>
  </div>
</header>
<div class="row article-body">
  <section class="twelve wide column"><h2 id="关于-dvd-格式">关于 DVD 格式</h2>
<ul>
<li>Digital Versatile Disc</li>
<li>DVD 五种格式
<ul>
<li>DVD-VIDEO – 可达 17 G</li>
<li>DVD-ROM</li>
<li>DVD-R – 4.7 G</li>
<li>DVD-RAM – 可以作为虚拟硬盘</li>
<li>DVD-AUDIO – 比 CD 的音频品质好一倍</li>
</ul></li>
<li>DVD 区域码
<ul>
<li>DVD 联盟将全世界依地理区域分为 1–6 区，而每一部 DVD 播放机及每一片 DVD 都会被锁定只能在某一区中播放（依产品贩卖的地区锁上相对应的区域码）</li>
<li>影片的锁码必须配合播放机的锁码（第 1 区的影片配合第 1 区的播放机，第 2 区的影片配合第2区的播放机.）你才能顺利的观赏影片!</li>
<li>后来产的 DVD 播放机一般可以播放全区域的 DVD</li>
</ul></li>
<li>DVD 版权保护
<ul>
<li>CSS（Content Scrambling System，内容乱码系统）</li>
<li>防类比设备翻录</li>
<li>区码限制</li>
</ul></li>
</ul>
<h2 id="关于-vob-格式">关于 VOB 格式</h2>
<ul>
<li>vob 文件用来保存所有 MPEG-2 格式的音频和视频数据，这些数据不仅包含影片本身，而且还有供菜单和按钮用的画面以及多种字幕的子画面流</li>
<li>.ifo 文件用于控制 VOB 文件的播放，在这个文件中可以找到如何控制 .vob 文件中数据播放的信息</li>
<li>有时候 .ifo 文件保存了一份副本，即同名的 .bup 文件</li>
<li>每个 DVD 光盘中都有视频管理器（VMG），它存放在 <code>VIDEOTS.ifo</code> 文件中，保存了光盘的全局信息，如光盘可以在哪个地区播放等</li>
<li>光盘还将用于显示菜单的数据保存在 <code>VIDEOTS.vob</code> 文件中，当光盘插入到光驱中时播放器会首先显示这个菜单，大多数菜单可让观众指定场景、选择语言字幕等</li>
</ul>
<h2 id="关于-ts-流和-ps-流">关于 TS 流和 PS 流</h2>
<h3 id="ts-流">TS 流</h3>
<ul>
<li>DVD 节目中的 MPEG-2 格式，TS 的全称则是 Transport Stream</li>
<li>MPEG-TS 主要应用于实时传送的节目，比如实时广播的电视节目</li>
<li>TS 码流由于采用了固定长度的包结构，当传输误码破坏了某一 TS 包的同步信息时，接收机可在固定的位置检测它后面包中的同步信息，从而恢复同步，避免了信息丢失</li>
<li>信道环境较为恶劣，传输误码较高时，一般采用 TS 码流</li>
<li>TS 流（DVB-T，DMB-TH等）如果断了码流，后面的随时可以再开始解码怎么看都行</li>
</ul>
<h3 id="ps-流">PS 流</h3>
<ul>
<li>DVD 节目中的 MPEG-2 格式，是 MPEG-PS，全称是 Program Stream</li>
<li>PS 包由于长度是变化的，一旦某一 PS包的同步信息丢失，接收机无法确定下一包的同步位置，就会造成失步，导致严重的信息丢失</li>
<li>在信道环境较好，传输误码较低时，一般采用 PS 码流如 DVD 等等</li>
<li>PS 流（主要用在 DVD 上）如是中间丢了一断码流，后面的都没法播了</li>
</ul>
<h2 id="关于-dvd-格式转换">关于 DVD 格式转换</h2>
<h3 id="几个概念">几个概念</h3>
<ul>
<li>angle – 高级的 DVD 支持同一段场景的不同视角（angle），一般的 DVD 只有一个视角</li>
<li>Title Set – 基本上一个 Title Set 的视频为一组内容，有的 DVD 会有好几个 Title Set，第一个 Title Set 往往是最长的，包含了主体影片的内容; 其余的 Title Set 往往是一些影片花絮啥的</li>
<li>chapter – 应该是 DVD 字幕上用于选择章节的东西</li>
</ul>
<h3 id="gui-抓取转换工具">GUI 抓取转换工具</h3>
<ol>
<li><p>Windows</p>
<ul>
<li><a href="http://www.formatoz.com/CN_index.html">格式工厂</a></li>
<li><a href="http://www.onlinedown.net/soft/16280.htm">视频转换大师</a></li>
<li>……还有很多……</li>
</ul></li>
<li><p>Linux</p>
<ul>
<li><a href="http://www.exit1.org/dvdrip/">dvd::rip</a>（Perl 写的 GTK 程序，好像只能抓取单段的视频，无法拼接）</li>
<li><a href="http://untrepid.com/acidrip/">acidrip</a></li>
<li><a href="http://thoggen.net/">thoggen</a></li>
</ul></li>
</ol>
<h2 id="cli-工具自动化脚本形式的抓取转换工具">CLI 工具，自动化（脚本形式）的抓取转换工具</h2>
<h3 id="基本工具">基本工具</h3>
<ul>
<li><a href="http://untrepid.com/acidrip/lsdvd.html">lsdvd</a> – 读取 DVD 信息，可以得到 title set、duration 信息等等</li>
<li><a href="http://dvdbackup.sourceforge.net/">dvdbackup</a> – rip video DVDs from the command line，同样可以读取 DVD 信息，有时需要 <a href="http://www.videolan.org/developers/libdvdcss.html">libdvdcss</a> 的支持，Ubuntu 上的安装方法可以参考 <a href="https://help.ubuntu.com/community/RestrictedFormats">Ubuntu Wiki</a></li>
<li><a href="http://h264enc.sourceforge.net/">h264enc</a> – 交互式的抓取工具，Bash 脚本，整个脚本将近一万行（支持非常多的配置选项）</li>
<li><a href="http://ffmpeg.org/">FFmpeg</a> and <a href="http://www.mplayerhq.hu/DOCS/HTML/en/mencoder.html">MEncoder</a> – Linux 下两款主要的音频和视频格式转换工具，绝大多数的GUI 工具都是这两个命令行工具的封装. 很多Windows播放器底层也是这两个。FFmpeg 还有个有趣的 <a href="http://ffmpeg.org/shame.html">Hall of Shame</a></li>
<li><a href="http://www.mplayerhq.hu/">MPlayer</a> and <a href="http://www.videolan.org/vlc/">VLC</a> – Linux 下两款非常有名的播放器，功能非常强大，支持 framebuffer 和 ascii lib 的输出，很有趣</li>
</ul>
<h3 id="土法炼钢提取-vob-视频文件并合成一整个视频文件">土法炼钢提取 vob 视频文件并合成一整个视频文件</h3>
<ul>
<li>原理: vob 文件可以直接拼接（ <code>cat file1.vob file2.vob &gt;&gt; new_file.vob</code> ），拼接出来的 vob 文件可以正常播放（测试了两个拼接的文件和拼接后转换的 f4v 文件，网页和本地播放器均正常播放到结尾）</li>
<li>思路:
<ul>
<li>先将整个的 DVD 内容拷贝到硬盘（比较节省光驱资源）</li>
<li>进入 DVD 视频文件目录（一般为 VIDEO<sub>TS</sub>）</li>
<li>用 lsdvd 或者 dvdbackup 工具找出 duration 最长的 title set，提取出这个 title set 里面的 vob 文件</li>
<li>cat 命令拼接这些 vob 成一个新的 vob 文件</li>
<li>利用 FFmpeg 转换脚本转换成新的格式</li>
</ul></li>
</ul>
<h3 id="h264enc-交互式脚本合并">h264enc 交互式脚本合并</h3>
<ul>
<li>原理: 给予 MEncoder 的转换工具，可以自动化的设置码率，滤镜，crop 参数，提取 vob文件合并到一个文件中（输出格式可以指定）</li>
<li>思路:
<ul>
<li>多做实验，将每次做实验的结果进行对比，选出最好的一组参数写成配置文件，调用 h264enc 做自动化的处理</li>
</ul></li>
</ul>
<h2 id="todo-list">Todo list</h2>
<ul>
<li>深入研究下 MEncoder 的使用方法，以及 MEncoder 和 FFmpeg 的不同和关联</li>
<li>深入了解分析下 h264enc 工具的脚本，了解下 h264enc 的配置文件</li>
</ul>

    <div class="ui divider"></div>
    <div class="ui small one item menu">
      <a class="item" id="show-disqus-comments" onclick="show_disqus_comments()" title="Fuck GFW, disqus.com has been blocked in China.">Show Disqus Comments</a>
    </div>
    <div id="disqus_thread"></div>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </section>
  <aside class="four wide column">
    <div class="ui small header">
      License
    </div>
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><img class="cc-license" src="/static/image/cc_byncsa.flat.guokr.svg" /></a>
    <div class="ui small header">
      Committed
    </div>
    <date>2010-08-05</date>
    <div class="ui small header">
      Updated
    </div>
    <date>2017-04-14</date>
    <div class="ui small header">
      Category
    </div>
    <div class="ui list">
      <div class="item">
        <a href="/categories#Linux">
          <div class="ui label">
            Linux<sup>20</sup>
          </div>
        </a>
      </div>
    </div>
    <div class="ui small header">
      Tags
    </div>
    <div class="ui list">
      <div class="item">
        <a href="/tags#DVD">
          <div class="ui label">
            DVD<sup>1</sup>
          </div>
        </a>
      </div>
      <div class="item">
        <a href="/tags#mencoder">
          <div class="ui label">
            mencoder<sup>1</sup>
          </div>
        </a>
      </div>
      <div class="item">
        <a href="/tags#h264enc">
          <div class="ui label">
            h264enc<sup>1</sup>
          </div>
        </a>
      </div>
    </div>
    <div class="ui small header">
      Meta
    </div>
    <p>
      Imported from <a href="http://cnlox.is-programmer.com/posts/19726.html">is-programmer</a>.
    </p>
    <div class="ui small header">
      Links
    </div>
    <div class="ui small two item menu">
      <a class="item" title="一个 Shell Script 的诞生" href="/posts/2010-08-04-a-small-shell-script/">Prev</a><a class="item" title="W3Cschool JavaScript 笔记（1）" href="/posts/2010-08-30-notes-on-w3cschool-javascript/">Next</a>
    </div>
  </aside>
</div>
    </article>
  </div>
</div>
    </div>
    <div id="footer">
      <footer class="ui inverted vertical center aligned footer segment">
        <div class="ui container">
          <p>
            Copyright © 2009–2017 by Xiao Hanyu — Powered by Emacs, Git, Pandoc, Ruby and Nanoc.
          </p>
        </div>
      </footer>
      <script src="/static/dist/semantic-ui/semantic.min.js"></script>
      <script src="/static/javascript/ga.js"></script>
      <script src="/static/javascript/default.js"></script>
    </div>
  </body>
</html>