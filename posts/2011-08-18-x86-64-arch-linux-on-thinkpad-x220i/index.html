<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" />
    <meta content="width=1300, initial-scale=1 user-scalable=yes" name="viewport" />
    <meta content="行者无疆，始于足下——行走，思考，在路上" name="description" />
    <meta content="web development, programming, typeface, typography" name="keywords" />
    <meta content="Xiao Hanyu" name="author" />
    <link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180" />
    <link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png" />
    <link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png" />
    <link href="/manifest.json" rel="manifest" />
    <link color="#5bbad5" href="/safari-pinned-tab.svg" rel="mask-icon" />
    <meta content="#ffffff" name="theme-color" />
    <title>x86-64 Arch Linux on ThinkPad x220i</title>
    <link href="/static/dist/semantic-ui/semantic.min.css" rel="stylesheet" type="text/css" />
    <link href="/static/dist/fonts.css/fonts.css" rel="stylesheet" type="text/css" />
    <link href="/static/stylesheet/default.css" rel="stylesheet" type="text/css" />
    <link href="/static/stylesheet/pandoc-code-highlight.css" rel="stylesheet" type="text/css" />
    <script src="/static/dist/jquery/jquery.min.js"></script>
  </head>
  <body lang="cn">
    <div data-quotes-cn="[{&quot;content&quot;:[&quot;天上星，亮晶晶，永灿烂，长安宁。&quot;,&quot;湖边竹，盈盈绿，报平安，多喜乐。&quot;],&quot;author&quot;:&quot;金庸&quot;,&quot;from&quot;:&quot;天龙八部&quot;},{&quot;content&quot;:[&quot;死亡是唯一一座永远亮着的灯塔，不管你向哪里航行，最终都得转向它指引的方向。一切都会逝去，只有死神永生。&quot;],&quot;author&quot;:&quot;刘慈欣&quot;,&quot;from&quot;:&quot;地球往事&quot;},{&quot;content&quot;:[&quot;我终于明白了为什么 Einstein 喜爱看守灯塔的职业，因为那样他可以在自己的心灵中建立一片宁静而自由的天空。&quot;],&quot;author&quot;:&quot;卢昌海&quot;,&quot;from&quot;:&quot;&lt;a href=\&quot;http://www.changhai.org\&quot;&gt;http://www.changhai.org&lt;/a&gt;&quot;},{&quot;content&quot;:[&quot;我宁愿游荡在你身边&quot;,&quot;做七天的野鬼&quot;,&quot;跟随你&quot;,&quot;就算落进最黑暗的地方&quot;,&quot;我的爱&quot;,&quot;也不会让我成为永远的孤魂&quot;],&quot;author&quot;:&quot;李安&quot;,&quot;from&quot;:&quot;卧虎藏龙&quot;},{&quot;content&quot;:[&quot;在中国，任何超脱飞扬的思想都会砰然坠地——现实的引力实在是太沉重了。&quot;],&quot;author&quot;:&quot;刘慈欣&quot;,&quot;from&quot;:&quot;地球往事&quot;},{&quot;content&quot;:[&quot;天下唯庸人无咎无誉。&quot;],&quot;author&quot;:&quot;梁启超&quot;,&quot;from&quot;:&quot;李鸿章传&quot;},{&quot;content&quot;:[&quot;沧海横流，血肉横飞，方显出英雄本色，当年万源保卫战，敌军在不到 30 华里的地面上，使用兵力竞达九十个团，数量十倍于红军，谁能记清当时打了多少次恶仗？每天要牺牲多少人？他却是不多的幸存者之一。而眼前，一切都沉寂了，流逝了。那惊心动魄的枪声，那撕肝裂肺的呐喊，那悲痛欲绝的咒骂和呻吟，那狼藉遍野的残肢断骨和头颅，那千疮百孔仍迎风飘扬的军旗；都沉寂了，流逝了，无影无踪了，犹如做了一场梦……&quot;],&quot;author&quot;:&quot;都梁&quot;,&quot;from&quot;:&quot;亮剑&quot;}]" data-quotes-en="[{&quot;content&quot;:[&quot;Pascal is for building pyramids—imposing, breathtaking, static structures built by armies pushing heavy blocks into place. Lisp is for building organisms—imposing, breathtaking, dynamic structures built by squads fitting fluctuating myriads of simpler organisms into place.&quot;],&quot;author&quot;:&quot;Alan J. Perlis&quot;,&quot;from&quot;:&quot;foreword for &lt;a href=\&quot;http://mitpress.mit.edu/sicp/\&quot;&gt;SICP&lt;/a&gt;&quot;},{&quot;content&quot;:[&quot;When you don&#39;t create things, you become defined by your tastes rather than ability. Your tastes only narrow &amp; exclude people. So create.&quot;],&quot;author&quot;:&quot;why the luck stiff&quot;,&quot;from&quot;:&quot;&lt;a href=\&quot;http://whymirror.github.io/\&quot;&gt;http://whymirror.github.io/&lt;/a&gt;&quot;},{&quot;content&quot;:[&quot;In theory, there is no difference between theory and practice. But, in practice, there is.&quot;],&quot;author&quot;:&quot;Jan L. A. van de Snepscheut&quot;,&quot;from&quot;:&quot;&lt;a href=\&quot;http://en.wikiquote.org/wiki/Jan_L._A._van_de_Snepscheut\&quot;&gt;Wikipedia&lt;/a&gt;&quot;},{&quot;content&quot;:[&quot;The future has already arrived. It is just not evenly distributed yet.&quot;],&quot;author&quot;:&quot;William Gibson&quot;,&quot;from&quot;:&quot;&lt;a href=\&quot;https://en.wikiquote.org/wiki/William_Gibson\&quot;&gt;Wikiquote&lt;/a&gt;&quot;},{&quot;content&quot;:[&quot;There are many ways of trying to understand programs. People often rely too much on one way, which is called \&quot;debugging\&quot; and consists of running a partly-understood program to see if it does what you expected. Another way, which ML advocates, is to install some means of understanding in the very programs themselves.&quot;],&quot;author&quot;:&quot;Robin Milner&quot;,&quot;from&quot;:&quot;foreword for &lt;a href=\&quot;http://www.ccs.neu.edu/home/matthias/BTML/\&quot;&gt;The Little MLer&lt;/a&gt;&quot;}]" id="quotes" style="display: none"></div>
    <div id="content">
      <nav class="ui borderless menu" lang="en">
        <div class="ui container">
          <a class="item" href="/"><img src="/static/image/gravatar-black.svg" /></a><a class="item" href="/archive">Archive</a><a class="item desktop-only" href="/categories">Categories</a><a class="item desktop-only" href="/tags">Tags</a><a class="item" href="/about">About</a>
          <div class="right menu">
            <div class="item desktop-only">
              <form action="https://www.google.com/search" class="ui form" method="get" target="_blank">
                <input name="q" type="hidden" value="site:xiaohanyu.me" />
                <div class="ui transparent left icon input">
                  <input name="q" placeholder="Search..." type="text" /><i class="search icon"></i>
                </div>
              </form>
            </div>
            <a class="item" href="https://github.com/xiaohanyu"><i class="github icon"></i></a><a class="item desktop-only" href="/atom.xml"><i class="feed icon"></i></a>
          </div>
        </div>
      </nav><div class="ui stackable container">
  <div class="ui very padded segment article">
    <article class="ui stackable divided grid"><header class="row article-head">
  <div class="column">
    <h1 class="ui header">
      x86-64 Arch Linux on ThinkPad x220i
    </h1>
    <div class="ui divider"></div>
  </div>
</header>
<div class="row article-body">
  <section class="twelve wide column"><p>去年换 x201i 的时候，曾经折腾出一篇 [[<a href="http://cnlox.is-programmer.com/posts/24172.html" class="uri">http://cnlox.is-programmer.com/posts/24172.html</a>][《x86-64 Arch Linux on ThinkPad x201i》]]，后来 x201i 陪我度过了毕业半年最为艰难的岁月，表现可圈可点，配合我自己调制的 ArchLinux，系统非产高效，让我在 4 个月的时间内搞定了 8 门课程、毕业设计，还看了不下二十部电影和纪录片。</p>
<p>说起操作系统重装，我也算究竟沙场了。基本上每半年会重装一次操作系统，从 XP，Vista，RedHat 9.0，Fedora，到 Ubuntu 8.x，转向 ArchLinux、Gentoo，甚至在华数淘宝实习的时候还装了 4 台PC和 2 台Dell的 PC Server。最长的一次要属第一次接触 Gentoo 的那次，装操作系统装了有 2 个星期，折腾了两个月，终于发现这个东西不符合低碳节能的基本要求，再一次不小心的 fsck 误操作中彻底结束了 Gentoo 之旅，回到了 Ubuntu 和Arch的怀抱。</p>
<p>来到百度第一天领到的新笔记本，x220i，好家伙，上网一搜，居然是今年最新款的 X 系列 ThinkPad。CPU是新一代的 SNB 架构。默认系统的十年前的 XP。本来我想另辟空间再装个 Linux 来个双系统，后来 XP 实在用着不爽，遂全盘格式化，全部分给 ArchLinux。</p>
<p>我一直有一个疑问：为什么 Windows 的命令行，无论是 CMD 还是 PowerShell，不能实现最简单的窗口最大化功能？</p>
<p>OS版本用的是 [[<a href="http://linuxtoy.org/archives/arch-linux-2010-05.html" class="uri">http://linuxtoy.org/archives/arch-linux-2010-05.html</a>][Arch Linux 2010.05]]，在 mirrors.sohu.com 上下载 [[<a href="http://mirrors.sohu.com/archlinux/iso/2010.05/archlinux-2010.05-core-dual.iso" class="uri">http://mirrors.sohu.com/archlinux/iso/2010.05/archlinux-2010.05-core-dual.iso</a>][ 支持 32 位及 64 位架构的 Dual 映像 ]]，用 UltraISO 刻录硬盘镜像到 U 盘上。本以为 ArchLinux 的安装会像以前一样轻车熟路，不曾想这次却遇到了以前从来没有遇到的一个大麻烦：网卡无法识别！！！</p>
<p>不能上网就意味着不能装 X，不能装 X 就意味着没有 Firefox，没有 Firefox 就意味我不能上网来写这篇博客。无奈之下，去同事的机器上下载了最新的 <a href="http://blog.linuxmint.com/?p=1760">Linux Mint 11</a>，痛快装好，网卡这次能用了。</p>
<p>Google搜索，发现 Arch Linux 2010.05 是 2.6.32的内核，而 Linux Mint 11 是 2.6.38的内核，因此我怀疑是不是 ArchLinux 内核比较老而 X220i 架构比较新的原因。搜索的过程中发现了一个叫做 <a href="http://wiki.archlinux.org/index.php/Archboot">ArchBoot</a> 的项目，说白了就是半官方的 ArchLinux 滚动更新 ISO。热切的下载了最新的 ArchBoot 刻录安装，但是不幸的是这个 ArchBoot 在我的笔记本上根本无法启动。</p>
<p>怎么办？要不重新叫 IT 部门的人重装下 XP？还是先用一段时间的 Mint，等下一个 ArchLinux 的官方安装版？</p>
<p>但我终究是忍不住的。电脑之于黑客，相当于宝剑之于剑客。没有顺手的系统，自然没有高效的工作和良好的心情。</p>
<p>于是不得不换一种思路：尝试手动去下载 Intel 网卡的驱动，然后编译安装，搞定网卡驱动后再联网升级到新的内核。事实证明这个策略是奏效的，所需要的网卡驱动程序可以在 Intel 的网站上 <a href="http://downloadcenter.intel.com/Detail_Desc.aspx?DwnldID=9180"> 下载 </a>。安装过程不再赘述，按照安装包里的说明即可。装好驱动后升级内核，装 X，装 KDE，简单配置下字体，一切顺理成章，不亦乐乎。</p>
<p>最后的两个问题依然是驱动相关。一个是显卡的问题，这个可以通过更新内核来搞定。一个是 ThinkPad 风扇的问题，x201i上的方案迁移到 X220i 上并不奏效，tpfand基本不可用。好在有 thinkfan，通过 yaourt 安装下。设置主要参考 <a href="http://apps.hi.baidu.com/share/detail/39726097"> 这里 </a>，但是原文中所设置的：</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">sensor</span> /proc/acpi/ibm/thermal (0, 3, 3, 2, 10, 0, 10, 0, 2, 2)</code></pre></div>
<p>并不存在。在 X220i 上的 /etc/thinkfan.conf 设置为：</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="co"># I use this on my T61p:                                                                                                                             </span>
<span class="co">#sensor /proc/acpi/ibm/thermal (0, 10, 15, 2, 10, 5, 0, 3, 0, 3)                                                                                     </span>

<span class="co"># (0,   0,   55)                                                                                                                                  </span>
<span class="co"># (1,   48,     60)                                                                                                                                  </span>
<span class="co"># (2,   50,     61)                                                                                                                                  </span>
<span class="co"># (3,   52,     63)                                                                                                                                  </span>
<span class="co"># (4,   56,     65)                                                                                                                                  </span>
<span class="co"># (5,   59,     66)                                                                                                                                  </span>
<span class="co"># (7,   63,     32767)                                                                                                                               </span>

<span class="ex">sensor</span> /sys/class/hwmon/hwmon0/temp1_input (0, 3, 3, 2, 10, 0, 10, 0, 2, 2)                                                                          
<span class="kw">(</span><span class="ex">0</span>, 0, 45<span class="kw">)</span>                                                                                                                                           
<span class="kw">(</span><span class="ex">1</span>, 45, 48<span class="kw">)</span>                                                                                                                                          
<span class="kw">(</span><span class="ex">2</span>, 48, 55<span class="kw">)</span>                                                                                                                                          
<span class="kw">(</span><span class="ex">3</span>, 55, 58<span class="kw">)</span>                                                                                                                                          
<span class="kw">(</span><span class="ex">4</span>, 58, 60<span class="kw">)</span>                                                                                                                                          
<span class="kw">(</span><span class="ex">5</span>, 60, 63<span class="kw">)</span>                                                                                                                                          
<span class="kw">(</span><span class="ex">6</span>, 63, 65<span class="kw">)</span>                                                                                                                                          
<span class="kw">(</span><span class="ex">7</span>, 65, 32767<span class="kw">)</span>            </code></pre></div>
<p>经过此番修整，x220i终于被我调教的舒舒服服，服服贴贴 <img src="file:///images/smiley/chito/shades_smile.gif" />。至于旧爱 x201i，简单修整了一下给妞用了。</p>
<p>最后许个愿望吧：希望在未来可见的三年内不要再折腾操作系统了。同时遥祝远在 Singapore 的阿黎早日搞定 MacBook 上的 Ubuntu，整好 MitSIM，顺利毕业。嘿。</p>

    <div class="ui divider"></div>
    <div class="ui small one item menu">
      <a class="item" id="show-disqus-comments" onclick="show_disqus_comments()" title="Fuck GFW, disqus.com has been blocked in China.">Show Disqus Comments</a>
    </div>
    <div id="disqus_thread"></div>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </section>
  <aside class="four wide column">
    <div class="ui small header">
      License
    </div>
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><img class="cc-license" src="/static/image/cc_byncsa.flat.guokr.svg" /></a>
    <div class="ui small header">
      Committed
    </div>
    <date>2011-08-18</date>
    <div class="ui small header">
      Updated
    </div>
    <date>2017-04-14</date>
    <div class="ui small header">
      Category
    </div>
    <div class="ui list">
      <div class="item">
        <a href="/categories#linux">
          <div class="ui label">
            Linux<sup>17</sup>
          </div>
        </a>
      </div>
    </div>
    <div class="ui small header">
      Tags
    </div>
    <div class="ui list">
      <div class="item">
        <a href="/tags#arch linux">
          <div class="ui label">
            Arch Linux<sup>4</sup>
          </div>
        </a>
      </div>
      <div class="item">
        <a href="/tags#x220i">
          <div class="ui label">
            X220i<sup>1</sup>
          </div>
        </a>
      </div>
    </div>
    <div class="ui small header">
      Meta
    </div>
    <p>
      Imported from <a href="http://cnlox.is-programmer.com/posts/28803.html">is-programmer</a>.
    </p>
    <div class="ui small header">
      Links
    </div>
    <div class="ui small two item menu">
      <a class="item" title="Resize VirtualBox VDI file" href="/posts/2011-07-29-resize-virtualbox-vdi-file/">Prev</a><a class="item" title="Learning SICP: (sqrt 2.0)" href="/posts/2011-08-30-learning-sicp-with-sqrt-function/">Next</a>
    </div>
  </aside>
</div>
    </article>
  </div>
</div>
    </div>
    <div id="footer">
      <footer class="ui inverted vertical center aligned footer segment">
        <div class="ui container">
          <p>
            Copyright © 2009–2017 by Xiao Hanyu — Powered by Emacs, Git, Pandoc, Ruby and Nanoc.
          </p>
        </div>
      </footer>
      <script src="/static/dist/semantic-ui/semantic.min.js"></script>
      <script src="/static/javascript/ga.js"></script>
      <script src="/static/javascript/default.js"></script>
    </div>
  </body>
</html>